<!DOCTYPE html>
<html>
<head>
  <title>Buyer Dashboard</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Buyer: Auction Leaderboard</h1>
  <ul id="bids"></ul>

  <script>
    const socket = io("http://localhost:4000");
    const lotId = 1; // watching lot 1
    socket.emit("join_lot", lotId);

    // Keep an array of all bids
    const bids = [];

    socket.on("new_bid", (bid) => {
      if (bid.supplier_name === undefined || bid.supplier_name === null || bid.supplier_name === "") {
        bid.supplier_name = bid.supplier_id ? `Supplier ${bid.supplier_id}` : "Unknown";
      }
      bids.push(bid);
      // Sort bids by amount ascending
      bids.sort((a, b) => a.amount - b.amount);
      // Clear the bids list
      const bidsUl = document.getElementById("bids");
      bidsUl.innerHTML = "";
      // Re-populate with sorted bids
      bids.forEach((b, index) => {
        const li = document.createElement("li");
        li.textContent = `#${index + 1} ${b.supplier_name}: $${b.amount}`;
        bidsUl.appendChild(li);
      });
    });
  </script>
</body>
</html>
