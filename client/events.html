<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Events</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script>
    window.requiredRoles = ["manager"];
  </script>
  <script src="/config.js"></script>
  <script src="/auth.js"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="manager.html" class="brand">Tendersmith</a>
      <ul class="nav-links">
        <li><a href="manager.html">Home</a></li>
        <li><a href="events.html">Events</a></li>
        <li><a href="organisations.html">Organisations</a></li>
        <li><a href="stats.html">Stats</a></li>
        <li><a href="account.html">Account</a></li>
        <li><button id="messages-btn" class="nav-icon-btn">ðŸ’¬</button></li>
      </ul>
    </div>
  </nav>

  <main class="events-page container">
    <div class="page-header text-center mb-4">
      <h2>Manage Events</h2>
      <p>Create and schedule auction events.</p>
    </div>

    <section id="create-event-section" class="text-center mb-5">
      <button class="btn btn-primary px-4 py-2" onclick="window.location.href='create-event.html'">Create New Event</button>
    </section>

    <section id="events-list-section">
      <h3 class="mb-3">Upcoming Events</h3>
      <div id="events-list"></div>
    </section>
  </main>
  <footer>
    <p>Tendersmith Â© 2025</p>
  </footer>

  <script>
    const eventsList = document.getElementById('events-list');

    async function loadEvents() {
      try {
        const res = await authFetch('/events');
        const events = await res.json();

        eventsList.innerHTML = '';
        if (events.length === 0) {
          eventsList.innerHTML = '<p>No events found.</p>';
          return;
        }

        events.forEach(evt => {
          const div = document.createElement('div');
          div.classList.add('event-item');
          div.innerHTML = `
            <div class="event-header">
              <h4 class="org-name">${evt.organisation_name || 'Unnamed Organisation'}</h4>
              <h5 class="category-name text-muted">${evt.category_name || 'No Category'}</h5>
              <p class="event-title">${evt.title || 'Untitled Event'}</p>
            </div>
            <div class="event-meta">
              <p class="event-time"><strong>Start:</strong> ${evt.auction_time ? new Date(evt.auction_time).toLocaleString() : 'TBA'}</p>
              <p class="event-status"><strong>Status:</strong> ${evt.type === 'sealed' ? 'Sealed' : 'Open'}</p>
              <p class="event-currency"><strong>Currency:</strong> ${evt.currency || '-'}</p>
            </div>
          `;
          div.addEventListener('click', () => {
            window.location.href = `event.html?id=${evt.id}`;
          });
          eventsList.appendChild(div);
        });
      } catch (err) {
        eventsList.innerHTML = '<p>Error loading events.</p>';
        console.error('Error fetching events:', err);
      }
    }
loadEvents()
</script>
</script>
  <!-- Socket.IO client -->
  <script src="/socket.io/socket.io.js"></script>
  <!-- Enable messaging script -->
  <script src="/messages.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>